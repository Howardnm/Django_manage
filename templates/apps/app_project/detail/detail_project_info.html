<div class="card mb-3">
    <!-- 1. 顶部：负责人信息 + 编辑操作 -->
    <div class="card-header bg-blue-lt">
            <!-- 头像 -->
            <span class="avatar avatar-md bg-white text-blue rounded me-3 font-weight-bold">
                {{ project.manager.username|slice:":1"|upper }}
            </span>
            <!-- 信息区 -->
            <div class="flex-fill overflow-hidden">
                <div class="fw-bold text-blue text-truncate">{{ project.name }}</div>
                <div class="text-black small text-truncate opacity-75">项目负责人：{{ project.manager.username }}</div>
            </div>

            <!-- 操作区：编辑按钮 -->
            <div class="ms-auto">
                <a href="{% url 'project_edit' project.pk %}" class="btn btn-icon btn-ghost-primary bg-white text-blue" title="编辑项目信息">
                    <i class="ti ti-edit"></i>
                </a>
            </div>
    </div>
    <div class="card-body p-3">
        <!-- 描述区 -->
        <div class="">
            <div class="small text-secondary" style="line-height: 1.6;">
                {% if project.description %}
                    {{ project.description }}
                {% else %}
                    <span class="fst-italic opacity-50">暂无项目描述...</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 2. 中间：关键指标 (数据条带) -->
    <div class="card-body p-0 border-top border-bottom bg-light-lt">
        <div class="row g-0">
            <!-- 创建时间 -->
            <div class="col-6 border-end p-2 text-center">
                <div class="text-uppercase text-muted text-truncate mb-1" style="font-size: 10px;">创建时间</div>
                <div class="font-weight-medium small text-primary">{{ project.created_at|date:"Y-m-d" }}</div>
            </div>
            <!-- 当前阶段 -->
            <div class="col-6 p-2 text-center">
                <div class="text-uppercase text-muted text-truncate mb-1" style="font-size: 10px;">当前阶段</div>
                <div class="font-weight-medium small text-primary">
                    <!-- 【优化】直接使用冗余字段 -->
                    {{ project.get_current_stage_display }}
                </div>
            </div>
        </div>
    </div>

    <!-- 3. 底部：进度条 -->
    <div class="card-body p-3">
        <div class="d-flex align-items-center justify-content-between mb-1">
            <span class="text-muted small fw-bold">总体进度</span>
            <!-- 【优化】直接使用冗余字段 -->
            <span class="ms-auto fw-bold small">{{ project.progress_percent }}%</span>
        </div>

        <div class="progress progress-sm" style="height: 6px;">
            <div class="progress-bar {% if project.is_terminated %}bg-danger{% elif project.progress_percent == 100 %}bg-success{% else %}bg-primary{% endif %}"
                 style="width: {{ project.progress_percent }}%"
                 role="progressbar"
                 aria-valuenow="{{ project.progress_percent }}"
                 aria-valuemin="0"
                 aria-valuemax="100">
            </div>
        </div>
    </div>
</div>