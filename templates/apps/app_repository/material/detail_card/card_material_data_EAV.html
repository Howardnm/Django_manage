<!-- 1. 动态性能数据 (紧凑型 EAV 视图) -->
{% load project_extras repo_tags %}

{% regroup sorted_properties by test_config.category as category_list %}

{% if category_list %}
    <div class="card mb-3">
        <div class="card-header">
            <h3 class="card-title">
                <i class="ti ti-chart-bar me-2 text-blue"></i>全维性能指标
            </h3>
        </div>

        <div class="card-body p-0">
            {% for category in category_list %}
                {% get_category_color category.grouper.name as theme_color %}

                <div class="p-2 {% if not forloop.last %}border-bottom{% endif %}">
                    <!-- 分类标题：紧凑型全宽胶囊 -->
                    <div class="mb-2">
                        <span class="badge bg-{{ theme_color }}-lt w-100 py-1 justify-content-start rounded text-{{ theme_color }} fs-5">
                            {% if theme_color == 'blue' %}<i class="ti ti-microscope me-2"></i>
                            {% elif theme_color == 'orange' %}<i class="ti ti-hammer me-2"></i>
                            {% elif theme_color == 'red' %}<i class="ti ti-flame me-2"></i>
                            {% else %}<i class="ti ti-list me-2"></i>{% endif %}
                            {{ category.grouper.name }}
                        </span>
                    </div>

                    <!-- 指标列表：极简胶囊风格 -->
                    <div class="row row-cards g-1">
                        {% for prop in category.list|dictsort:"test_config.order" %}
                            <div class="col-6">
                                <div class="border rounded px-2 py-1 d-flex align-items-center justify-content-between bg-white h-100 position-relative">

                                    <!-- 左侧：名称 -->
                                    <div class="text-truncate fw-bold text-dark" style="font-size: 13px; max-width: 35%;" title="{{ prop.test_config.name }}">
                                        {{ prop.test_config.name }}
                                    </div>

                                    <!-- 中间：标准 (绝对定位居中) -->
                                    <div class="position-absolute start-50 translate-middle-x text-center" style="max-width: 30%;">
                                        <div class="text-truncate text-muted" style="font-size: 11px;"
                                             title="{{ prop.test_config.standard }} {{ prop.test_config.condition }}">
                                            {{ prop.test_config.standard }}
                                            {% if prop.test_config.condition %}
                                                <span class="mx-1">·</span>{{ prop.test_config.condition }}
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- 右侧：数值 (高亮加粗) -->
                                    <div class="text-end lh-1 ms-1" style="min-width: 30%;">
                                        <div class="fw-bolder fs-4 text-{{ theme_color }}">
                                            {{ prop.value }}
                                        </div>
                                        {% if prop.test_config.unit %}
                                            <div class="text-muted small text-truncate" style="font-size: 9px;">{{ prop.test_config.unit }}</div>
                                        {% endif %}
                                    </div>

                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% else %}
    <!-- 空状态 -->
    <div class="card mb-3">
        <div class="card-body text-center py-5">
            <div class="empty-icon"><i class="ti ti-flask-off fs-1 opacity-25"></i></div>
            <p class="text-muted">暂无详细性能数据</p>
            <a href="{% url 'repo_material_edit' material.pk %}" class="btn btn-primary">立即录入数据</a>
        </div>
    </div>
{% endif %}