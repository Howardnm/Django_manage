{% extends "base.html" %}

{% block content %}
    <div class="page-header d-print-none">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="page-title">{{ page_title }}</h2>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">所属分类</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                            <div class="invalid-feedback d-block">{{ form.category.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">指标名称</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">测试标准</label>
                        {{ form.standard }}
                        {% if form.standard.errors %}
                            <div class="invalid-feedback d-block">{{ form.standard.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">测试条件</label>
                        {{ form.condition }}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">单位</label>
                        {{ form.unit }}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">排序权重</label>
                        {{ form.order }}
                        <small class="form-hint">数字越小越靠前</small>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">数据类型</label>
                        {{ form.data_type }}
                        <small class="form-hint">决定录入时的控件类型</small>
                    </div>

                    <div class="col-md-12 mb-3" id="options-config-container" style="display: none;">
                        <label class="form-label">选项配置</label>
                        {{ form.options_config }}
                        <small class="form-hint">仅当类型为"选择"时有效，用逗号分隔选项，如: V-0,V-1,HB</small>
                    </div>
                </div>

                <div class="form-footer">
                    <button type="submit" class="btn btn-primary">保存</button>
                    <a href="{% url 'repo_test_config_list' %}" class="btn btn-link">取消</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dataTypeSelect = document.querySelector('[name="data_type"]');
            const optionsContainer = document.getElementById('options-config-container');

            function toggleOptions() {
                if (dataTypeSelect.value === 'SELECT') {
                    optionsContainer.style.display = 'block';
                } else {
                    optionsContainer.style.display = 'none';
                }
            }

            // 初始化
            toggleOptions();

            // 监听变化
            dataTypeSelect.addEventListener('change', toggleOptions);
        });
    </script>
{% endblock %}